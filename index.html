<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(45deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            padding-bottom: 90px; /* Ù…Ø³Ø§ÙØ© Ù„Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
            color: #fff;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ (Glassmorphism) */
        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 15px;
            color: white;
            transition: transform 0.2s;
        }
        
        .glass-input, .glass-select {
            background: rgba(255, 255, 255, 0.2) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            color: #fff !important;
        }
        
        .glass-input::placeholder { color: rgba(255, 255, 255, 0.7); }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.3) !important;
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .table-glass {
            color: white;
            border-color: rgba(255,255,255,0.2);
        }
        .table-glass th, .table-glass td {
            background: transparent;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            vertical-align: middle;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .bottom-nav {
            position: fixed; bottom: 15px; left: 15px; right: 15px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex; justify-content: space-around;
            padding: 10px 0; z-index: 1000;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .nav-item { text-align: center; color: rgba(255,255,255,0.6); cursor: pointer; flex: 1; transition: 0.3s; }
        .nav-item.active { color: #fff; transform: scale(1.1); text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .nav-icon { font-size: 1.6rem; display: block; }
        .nav-text { font-size: 0.75rem; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø¶ÙˆØ± */
        .btn-check-custom {
            font-size: 1.5rem; cursor: pointer; transition: 0.2s;
            opacity: 0.5; filter: grayscale(100%);
        }
        .btn-check-custom.checked {
            opacity: 1; filter: grayscale(0%); transform: scale(1.2);
            text-shadow: 0 0 15px #00ff00;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© */
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .balance-pos { color: #76ff03; font-weight: bold; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .balance-neg { color: #ff5252; font-weight: bold; text-shadow: 0 0 5px rgba(0,0,0,0.5); }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        option { background-color: #333; color: white; }
    </style>
</head>
<body>

<div class="container py-4">

    <div id="tab-home" class="tab-content active">
        <h3 class="text-center mb-4 fw-bold" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¹Ù…Ø§Ù„</h3>
        
        <div class="glass-card p-3">
            <div class="table-responsive">
                <table class="table table-glass text-center mb-0">
                    <thead>
                        <tr>
                            <th width="40%">Ø§Ù„Ø§Ø³Ù…</th>
                            <th width="30%">Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</th>
                            <th width="30%">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ù‡</th>
                        </tr>
                    </thead>
                    <tbody id="mainTableBody">
                        </tbody>
                </table>
            </div>
            <div class="text-center mt-3" id="emptyMsg">
                <small style="opacity: 0.7;">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©.. Ø£Ø¶Ù Ø¹Ù…Ø§Ù„Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ ğŸ‘‡</small>
            </div>
        </div>
    </div>

    <div id="tab-loans" class="tab-content">
        <h3 class="text-center mb-4 fw-bold">ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ù</h3>
        
        <div class="glass-card p-3">
            <label class="mb-2 fw-bold">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„:</label>
            <select id="workerSelect" class="form-select glass-select mb-3" onchange="loadWorkerHistory()">
                <option value="">-- Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --</option>
            </select>

            <div class="row text-center mb-3 g-2">
                <div class="col-6">
                    <div class="p-2" style="background: rgba(255,0,0,0.2); border-radius: 10px;">
                        <small>Ù…Ø³Ø­ÙˆØ¨Ø§Øª (Ø¹Ù„ÙŠÙ‡)</small>
                        <div id="dispTotalWithdraw" class="fw-bold text-white">0</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="p-2" style="background: rgba(0,255,0,0.2); border-radius: 10px;">
                        <small>Ø§Ù„ØµØ§ÙÙŠ (Ø§Ù„Ø¨Ø§Ù‚ÙŠ)</small>
                        <div id="dispBalance" class="fw-bold text-white">0</div>
                    </div>
                </div>
            </div>

            <hr style="border-color: rgba(255,255,255,0.3)">
            
            <h6>ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© ÙŠØ¯ÙˆÙŠØ©:</h6>
            <div class="input-group mb-2">
                <input type="number" id="transAmount" class="form-control glass-input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº...">
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-danger w-50" style="backdrop-filter: blur(5px);" onclick="addTransaction('withdraw')">Ø³Ø­Ø¨ Ø³Ù„ÙØ© ğŸ’¸</button>
                <button class="btn btn-success w-50" style="backdrop-filter: blur(5px);" onclick="addTransaction('wage')">ØªÙ†Ø²ÙŠÙ„ ÙŠÙˆÙ…ÙŠØ© ğŸ”¨</button>
            </div>
        </div>

        <h6 class="mt-3 px-2">Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙƒØ§Øª:</h6>
        <div class="glass-card p-2">
            <table class="table table-glass table-sm text-center mb-0" style="font-size: 0.9rem;">
                <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead>
                <tbody id="historyTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-add" class="tab-content">
        <h3 class="text-center mb-4 fw-bold">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ Ø¬Ø¯ÙŠØ¯</h3>
        <div class="glass-card p-4">
            <div class="mb-4">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„:</label>
                <input type="text" id="newWorkerName" class="form-control glass-input form-control-lg" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§...">
            </div>
            <button class="btn btn-light w-100 btn-lg fw-bold" style="color: #333;" onclick="addNewWorker()">Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ù…Ù„ âœ…</button>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)">
        <span class="nav-icon">ğŸ‘·â€â™‚ï¸</span>
        <span class="nav-text">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    <div class="nav-item" onclick="switchTab('loans', this)">
        <span class="nav-icon">ğŸ’°</span>
        <span class="nav-text">Ø§Ù„Ø³Ù„Ù</span>
    </div>
    <div class="nav-item" onclick="switchTab('add', this)">
        <span class="nav-icon">â•</span>
        <span class="nav-text">Ø¥Ø¶Ø§ÙØ©</span>
    </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // === Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
    let workers = JSON.parse(localStorage.getItem('workersApp_Glass')) || [];

    window.onload = function() {
        renderMainTable();
        updateSelectMenu();
    };

    // === Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ===
    function switchTab(tabName, navElement) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navElement.classList.add('active');
        
        if(tabName === 'home') renderMainTable();
        if(tabName === 'loans') updateSelectMenu();
    }

    // === 1. Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ Ø¬Ø¯ÙŠØ¯ ===
    function addNewWorker() {
        const nameInp = document.getElementById('newWorkerName');
        const name = nameInp.value.trim();
        if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…!");

        workers.push({ name: name, history: [] });
        saveData();
        nameInp.value = '';
        
        // Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        document.querySelector('.nav-item:first-child').click(); 
    }

    // === 2. Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ + Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø¶ÙˆØ± (âœ…) ===
    function renderMainTable() {
        const tbody = document.getElementById('mainTableBody');
        tbody.innerHTML = '';
        
        if(workers.length > 0) document.getElementById('emptyMsg').style.display = 'none';

        const today = new Date().toISOString().split('T')[0];

        workers.forEach((worker, index) => {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ù„ Ø­Ø¶Ø± Ø§Ù„ÙŠÙˆÙ…ØŸ (Ù‡Ù„ ØªÙˆØ¬Ø¯ ÙŠÙˆÙ…ÙŠØ© Ù…Ø³Ø¬Ù„Ø© Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…)
            const workedToday = worker.history.some(h => h.date === today && h.type === 'wage');
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯
            let balance = calculateBalance(worker);
            let colorClass = balance >= 0 ? 'balance-pos' : 'balance-neg';
            
            // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
            let checkIcon = workedToday ? 'âœ…' : 'â¬œ';
            let checkClass = workedToday ? 'btn-check-custom checked' : 'btn-check-custom';

            tbody.innerHTML += `
                <tr>
                    <td class="fw-bold">${worker.name}</td>
                    <td>
                        <div class="${checkClass}" onclick="toggleAttendance(${index})">
                            ${checkIcon}
                        </div>
                    </td>
                    <td class="${colorClass}" style="direction:ltr">${balance.toLocaleString()}</td>
                </tr>
            `;
        });
    }

    // === ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø³Ø±ÙŠØ¹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ===
    function toggleAttendance(index) {
        const today = new Date().toISOString().split('T')[0];
        const worker = workers[index];
        const alreadyPresent = worker.history.some(h => h.date === today && h.type === 'wage');

        if (alreadyPresent) {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¶ÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ Ù„Ù„ÙŠÙˆÙ…ØŸ (Ø³ÙŠØªÙ… Ø­Ø°Ù ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ÙŠÙˆÙ…)")) {
                // Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
                worker.history = worker.history.filter(h => !(h.date === today && h.type === 'wage'));
                saveData();
                renderMainTable();
            }
        } else {
            // Ø·Ù„Ø¨ Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            let wage = prompt("Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ø¹Ø§Ù…Ù„ " + worker.name + ":", "25000");
            if (wage && !isNaN(wage)) {
                worker.history.push({
                    date: today,
                    type: 'wage',
                    amount: parseFloat(wage)
                });
                saveData();
                renderMainTable();
            }
        }
    }

    // === 3. Ù‚Ø³Ù… Ø§Ù„Ø³Ù„Ù ===
    function updateSelectMenu() {
        const select = document.getElementById('workerSelect');
        const oldVal = select.value;
        select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>';
        workers.forEach((w, i) => {
            select.innerHTML += `<option value="${i}">${w.name}</option>`;
        });
        select.value = oldVal;
    }

    function loadWorkerHistory() {
        const index = document.getElementById('workerSelect').value;
        const tbody = document.getElementById('historyTableBody');
        const dispTotal = document.getElementById('dispTotalWithdraw');
        const dispBal = document.getElementById('dispBalance');

        tbody.innerHTML = '';
        if(index === "") {
            dispTotal.innerText = "0"; dispBal.innerText = "0";
            return;
        }

        const worker = workers[index];
        let totalWithdraw = 0;
        let totalWage = 0;

        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„
        [...worker.history].reverse().forEach(h => {
            if(h.type === 'withdraw') totalWithdraw += h.amount;
            else totalWage += h.amount;

            let typeText = h.type === 'withdraw' ? '<span class="badge bg-danger">Ø³Ù„ÙØ©</span>' : '<span class="badge bg-success">ÙŠÙˆÙ…ÙŠØ©</span>';
            
            tbody.innerHTML += `
                <tr>
                    <td>${h.date}</td>
                    <td>${typeText}</td>
                    <td>${h.amount.toLocaleString()}</td>
                </tr>
            `;
        });

        dispTotal.innerText = totalWithdraw.toLocaleString();
        let finalBal = totalWage - totalWithdraw;
        dispBal.innerText = finalBal.toLocaleString();
        // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø§Ù„Ø£Ø¨ÙŠØ¶ Ù„ÙŠÙƒÙˆÙ† ÙˆØ§Ø¶Ø­Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ©
    }

    function addTransaction(type) {
        const index = document.getElementById('workerSelect').value;
        const amount = parseFloat(document.getElementById('transAmount').value);

        if(index === "") return alert("Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹");
        if(!amount) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº");

        workers[index].history.push({
            date: new Date().toISOString().split('T')[0],
            type: type, 
            amount: amount
        });
        
        saveData();
        document.getElementById('transAmount').value = '';
        loadWorkerHistory(); 
    }

    // === Ø£Ø¯ÙˆØ§Øª ===
    function calculateBalance(worker) {
        let w = 0, wd = 0;
        worker.history.forEach(h => {
            if(h.type === 'wage') w += h.amount;
            if(h.type === 'withdraw') wd += h.amount;
        });
        return w - wd;
    }

    function saveData() {
        localStorage.setItem('workersApp_Glass', JSON.stringify(workers));
    }
</script>

</body>
</html>
