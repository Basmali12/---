<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ø³Ù„Ù</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; padding-bottom: 80px; /* Ù…Ø³Ø§ÙØ© Ù„Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */ }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card-custom { border: none; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); background: white; margin-bottom: 15px; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; border-top: 1px solid #ddd;
            display: flex; justify-content: space-around;
            padding: 10px 0; z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .nav-item { text-align: center; color: #6c757d; cursor: pointer; flex: 1; }
        .nav-item.active { color: #0d6efd; font-weight: bold; }
        .nav-icon { font-size: 1.5rem; display: block; margin-bottom: 2px; }
        .nav-text { font-size: 0.8rem; }

        /* Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .balance-pos { color: green; font-weight: bold; }
        .balance-neg { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container py-3">

    <div id="tab-home" class="tab-content active">
        <h4 class="text-center mb-3">ğŸ‘·â€â™‚ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</h4>
        
        <div class="card card-custom p-3">
            <div class="table-responsive">
                <table class="table table-bordered text-center align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>ØµØ§ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="mainTableBody">
                        </tbody>
                </table>
            </div>
            <div class="text-center mt-3 text-muted" id="emptyMsg">
                <small>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ø§Ù„.. Ø§Ù†ØªÙ‚Ù„ Ù„ØªØ¨ÙˆÙŠØ¨ "Ø¥Ø¶Ø§ÙØ©" Ù„Ù„Ø¨Ø¯Ø¡</small>
            </div>
        </div>
    </div>

    <div id="tab-loans" class="tab-content">
        <h4 class="text-center mb-3 text-danger">ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ù</h4>
        
        <div class="card card-custom p-3">
            <label class="form-label fw-bold">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„:</label>
            <select id="workerSelect" class="form-select mb-3" onchange="loadWorkerHistory()">
                <option value="">-- Ø§Ø®ØªØ± --</option>
            </select>

            <div class="row text-center mb-3">
                <div class="col-6">
                    <div class="p-2 bg-light rounded">
                        <small>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ù„Ù</small>
                        <div id="dispTotalWithdraw" class="text-danger fw-bold">0</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="p-2 bg-light rounded">
                        <small>Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ù‡</small>
                        <div id="dispBalance" class="fw-bold">0</div>
                    </div>
                </div>
            </div>

            <hr>
            <h6>ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©:</h6>
            <div class="input-group mb-2">
                <span class="input-group-text">Ø§Ù„Ù…Ø¨Ù„Øº</span>
                <input type="number" id="transAmount" class="form-control">
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-danger flex-grow-1" onclick="addTransaction('withdraw')">Ø¥Ø¹Ø·Ø§Ø¡ Ø³Ù„ÙØ© ğŸ“¤</button>
                <button class="btn btn-success flex-grow-1" onclick="addTransaction('wage')">ØªØ³Ø¬ÙŠÙ„ ÙŠÙˆÙ…ÙŠØ© ğŸ“¥</button>
            </div>
        </div>

        <h6 class="mt-3">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø±ÙƒØ§Øª:</h6>
        <div class="card card-custom p-2">
            <table class="table table-sm table-striped text-center mb-0" style="font-size: 0.9rem;">
                <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø±ÙƒØ©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead>
                <tbody id="historyTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-add" class="tab-content">
        <h4 class="text-center mb-3">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ Ø¬Ø¯ÙŠØ¯</h4>
        <div class="card card-custom p-4">
            <div class="mb-3">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                <input type="text" id="newWorkerName" class="form-control form-control-lg">
            </div>
            <button class="btn btn-primary w-100 btn-lg" onclick="addNewWorker()">Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ù…Ù„</button>
        </div>
        <div class="alert alert-info mt-3">
            <small>ğŸ’¡ Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ù„ØŒ Ø§Ù†ØªÙ‚Ù„ Ù„Ù‚Ø³Ù… "Ø§Ù„Ø³Ù„Ù" Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠÙˆÙ…ÙŠØ§ØªÙ‡ Ø£Ùˆ Ù…Ø³Ø­ÙˆØ¨Ø§ØªÙ‡.</small>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)">
        <span class="nav-icon">ğŸ‘·â€â™‚ï¸</span>
        <span class="nav-text">Ø§Ù„Ø¹Ù…Ø§Ù„</span>
    </div>
    <div class="nav-item" onclick="switchTab('loans', this)">
        <span class="nav-icon">ğŸ’°</span>
        <span class="nav-text">Ø§Ù„Ø³Ù„Ù</span>
    </div>
    <div class="nav-item" onclick="switchTab('add', this)">
        <span class="nav-icon">â•</span>
        <span class="nav-text">Ø¥Ø¶Ø§ÙØ©</span>
    </div>
</nav>

<script>
    // === Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
    let workers = JSON.parse(localStorage.getItem('workersApp_Tabs')) || [];

    // === Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ===
    window.onload = function() {
        renderMainTable();
        updateSelectMenu();
    };

    // === 1. Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ===
    function switchTab(tabName, navElement) {
        // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        document.getElementById('tab-' + tabName).classList.add('active');

        // ØªØ­Ø¯ÙŠØ« Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ©
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navElement.classList.add('active');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªÙ†Ù‚Ù„
        if(tabName === 'home') renderMainTable();
        if(tabName === 'loans') updateSelectMenu();
    }

    // === 2. Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ Ø¬Ø¯ÙŠØ¯ (ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¶Ø§ÙØ©) ===
    function addNewWorker() {
        const nameInp = document.getElementById('newWorkerName');
        const name = nameInp.value.trim();
        if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…!");

        workers.push({ name: name, history: [] });
        saveData();
        nameInp.value = '';
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        document.querySelector('.nav-item:first-child').click(); 
    }

    // === 3. Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„) ===
    function renderMainTable() {
        const tbody = document.getElementById('mainTableBody');
        tbody.innerHTML = '';
        
        if(workers.length > 0) document.getElementById('emptyMsg').style.display = 'none';

        workers.forEach((worker, index) => {
            let balance = calculateBalance(worker);
            let colorClass = balance >= 0 ? 'balance-pos' : 'balance-neg'; // Ø£Ø®Ø¶Ø± Ø£Ùˆ Ø£Ø­Ù…Ø±
            
            tbody.innerHTML += `
                <tr>
                    <td>${worker.name}</td>
                    <td class="${colorClass}" style="direction:ltr">${balance.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-secondary" onclick="goToLoans(${index})">
                            ÙƒØ´Ù ğŸ“„
                        </button>
                    </td>
                </tr>
            `;
        });
    }

    // === 4. Ù‚Ø³Ù… Ø§Ù„Ø³Ù„Ù (ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ù„Ù) ===
    function updateSelectMenu() {
        const select = document.getElementById('workerSelect');
        const oldVal = select.value;
        select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>';
        workers.forEach((w, i) => {
            select.innerHTML += `<option value="${i}">${w.name}</option>`;
        });
        select.value = oldVal;
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ù† Ø²Ø± "ÙƒØ´Ù" ÙÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ø³Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©
    function goToLoans(index) {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ù„Ù
        const loansTabBtn = document.querySelectorAll('.nav-item')[1]; 
        switchTab('loans', loansTabBtn);
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
        const select = document.getElementById('workerSelect');
        select.value = index;
        loadWorkerHistory();
    }

    function loadWorkerHistory() {
        const index = document.getElementById('workerSelect').value;
        const tbody = document.getElementById('historyTableBody');
        const dispTotal = document.getElementById('dispTotalWithdraw');
        const dispBal = document.getElementById('dispBalance');

        tbody.innerHTML = '';
        if(index === "") {
            dispTotal.innerText = "0"; dispBal.innerText = "0";
            return;
        }

        const worker = workers[index];
        let totalWithdraw = 0;
        let totalWage = 0;

        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„
        [...worker.history].reverse().forEach(h => {
            if(h.type === 'withdraw') totalWithdraw += h.amount;
            else totalWage += h.amount;

            let typeText = h.type === 'withdraw' ? '<span class="badge bg-danger">Ø³Ù„ÙØ©</span>' : '<span class="badge bg-success">ÙŠÙˆÙ…ÙŠØ©</span>';
            
            tbody.innerHTML += `
                <tr>
                    <td>${h.date}</td>
                    <td>${typeText}</td>
                    <td>${h.amount.toLocaleString()}</td>
                </tr>
            `;
        });

        dispTotal.innerText = totalWithdraw.toLocaleString();
        let finalBal = totalWage - totalWithdraw;
        dispBal.innerText = finalBal.toLocaleString();
        dispBal.className = finalBal >= 0 ? 'fw-bold text-success' : 'fw-bold text-danger';
    }

    function addTransaction(type) {
        const index = document.getElementById('workerSelect').value;
        const amount = parseFloat(document.getElementById('transAmount').value);

        if(index === "") return alert("Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹");
        if(!amount) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº");

        workers[index].history.push({
            date: new Date().toISOString().split('T')[0],
            type: type, // 'wage' or 'withdraw'
            amount: amount
        });
        
        saveData();
        document.getElementById('transAmount').value = '';
        loadWorkerHistory(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙˆØ±Ø§Ù‹
    }

    // === Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ===
    function calculateBalance(worker) {
        let w = 0, wd = 0;
        worker.history.forEach(h => {
            if(h.type === 'wage') w += h.amount;
            if(h.type === 'withdraw') wd += h.amount;
        });
        return w - wd;
    }

    function saveData() {
        localStorage.setItem('workersApp_Tabs', JSON.stringify(workers));
    }
</script>

</body>
</html>
