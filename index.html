<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(45deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            padding-bottom: 90px; /* Ù…Ø³Ø§ÙØ© Ù„Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
            color: #fff;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ (Glassmorphism) */
        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 15px;
            color: white;
            transition: transform 0.2s;
        }
        
        .glass-input, .glass-select {
            background: rgba(255, 255, 255, 0.2) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            color: #fff !important;
        }
        
        .glass-input::placeholder { color: rgba(255, 255, 255, 0.7); }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.3) !important;
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .table-glass {
            color: white;
            border-color: rgba(255,255,255,0.2);
        }
        .table-glass th, .table-glass td {
            background: transparent;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            vertical-align: middle;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .bottom-nav {
            position: fixed; bottom: 15px; left: 15px; right: 15px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex; justify-content: space-around;
            padding: 10px 0; z-index: 1000;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .nav-item { text-align: center; color: rgba(255,255,255,0.6); cursor: pointer; flex: 1; transition: 0.3s; }
        .nav-item.active { color: #fff; transform: scale(1.1); text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .nav-icon { font-size: 1.4rem; display: block; }
        .nav-text { font-size: 0.7rem; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø¶ÙˆØ± */
        .btn-check-custom {
            font-size: 1.5rem; cursor: pointer; transition: 0.2s;
            opacity: 0.5; filter: grayscale(100%);
        }
        .btn-check-custom.checked {
            opacity: 1; filter: grayscale(0%); transform: scale(1.2);
            text-shadow: 0 0 15px #00ff00;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© */
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .balance-pos { color: #76ff03; font-weight: bold; text-shadow: 0 0 5px rgba(0,0,0,0.5); } /* Ø£Ø®Ø¶Ø± = ÙŠØ·Ù„Ø¨Ù†Ø§ */
        .balance-neg { color: #ff5252; font-weight: bold; text-shadow: 0 0 5px rgba(0,0,0,0.5); } /* Ø£Ø­Ù…Ø± = Ø¹Ù„ÙŠÙ‡ Ø¯ÙŠÙ† */

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        option { background-color: #333; color: white; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .worker-list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .worker-name-click { cursor: pointer; font-weight: bold; font-size: 1.1rem; text-decoration: underline; text-underline-offset: 4px; }
        
        /* Modal Glass */
        .modal-content-glass {
            background: rgba(40, 40, 60, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 15px;
        }
    </style>
</head>
<body>

<div class="container py-4">

    <div id="tab-home" class="tab-content active">
        <h3 class="text-center mb-4 fw-bold" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
        
        <div class="glass-card p-3 text-center mb-3">
            <h6 class="mb-2 text-white-50">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ† (Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† Ø§Ù„Ø¹Ù…Ø§Ù„)</h6>
            <h2 id="grandTotalDisplay" class="fw-bold m-0 text-white">0 Ø¯.Ø¹</h2>
        </div>

        <div class="glass-card p-3">
            <div class="table-responsive">
                <table class="table table-glass text-center mb-0">
                    <thead>
                        <tr>
                            <th width="10%">#</th>
                            <th width="40%">Ø§Ù„Ø§Ø³Ù…</th>
                            <th width="20%">Ø­Ø¶ÙˆØ±</th>
                            <th width="30%">Ø§Ù„ØµØ§ÙÙŠ (Ø¹Ù„ÙŠÙ‡)</th>
                        </tr>
                    </thead>
                    <tbody id="mainTableBody">
                        </tbody>
                </table>
            </div>
            <div class="text-center mt-3" id="emptyMsg">
                <small style="opacity: 0.7;">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©.. Ø£Ø¶Ù Ø¹Ù…Ø§Ù„Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ ğŸ‘‡</small>
            </div>
        </div>
    </div>

    <div id="tab-loans" class="tab-content">
        <h3 class="text-center mb-4 fw-bold">ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ù</h3>
        
        <div class="glass-card p-3">
            <label class="mb-2 fw-bold">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„:</label>
            <select id="workerSelect" class="form-select glass-select mb-3" onchange="loadWorkerHistory()">
                <option value="">-- Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --</option>
            </select>

            <div class="glass-card p-3 text-center mb-3" style="background: rgba(0,0,0,0.2);">
                <small class="text-light">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØµØ§ÙÙŠ (Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„ÙŠÙ‡)</small>
                <h2 id="dispBalance" class="fw-bold mt-2">0 Ø¯.Ø¹</h2>
            </div>

            <hr style="border-color: rgba(255,255,255,0.3)">
            
            <h6>ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©:</h6>
            <div class="input-group mb-2">
                <input type="number" id="transAmount" class="form-control glass-input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±...">
            </div>
            <div class="d-flex gap-2 mb-2">
                <button class="btn btn-danger flex-grow-1" style="backdrop-filter: blur(5px);" onclick="addTransaction('withdraw')">Ø³Ø­Ø¨ Ø³Ù„ÙØ© (+)</button>
                <button class="btn btn-info flex-grow-1" style="backdrop-filter: blur(5px); color:white;" onclick="addTransaction('repay')">ØªØ³Ø¯ÙŠØ¯ (-)</button>
            </div>
            <button class="btn btn-success w-100" style="backdrop-filter: blur(5px);" onclick="addTransaction('wage')">ØªÙ†Ø²ÙŠÙ„ ÙŠÙˆÙ…ÙŠØ© Ø¹Ù…Ù„ (ÙŠÙ†Ù‚Øµ Ù…Ù† Ø§Ù„Ø¯ÙŠÙ†)</button>
        </div>

        <h6 class="mt-3 px-2">Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙƒØ§Øª:</h6>
        <div class="glass-card p-2">
            <table class="table table-glass table-sm text-center mb-0" style="font-size: 0.9rem;">
                <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead>
                <tbody id="historyTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-workers" class="tab-content">
        <h3 class="text-center mb-4 fw-bold">ğŸ‘· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
        <div class="glass-card p-2" id="manageWorkersList">
            </div>
    </div>

    <div id="tab-add" class="tab-content">
        <h3 class="text-center mb-4 fw-bold">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„</h3>
        <div class="glass-card p-4">
            <div class="mb-4">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„:</label>
                <input type="text" id="newWorkerName" class="form-control glass-input form-control-lg" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§...">
            </div>
            <button class="btn btn-light w-100 btn-lg fw-bold" style="color: #333;" onclick="addNewWorker()">Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ù…Ù„ âœ…</button>
        </div>
    </div>

</div>

<div class="modal fade" id="attendanceModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-content-glass">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title" id="attModalTitle">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <ul class="list-group mb-3" id="attPresentList" style="max-height: 300px; overflow-y: auto;">
                    </ul>
            </div>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-text">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    <div class="nav-item" onclick="switchTab('loans', this)">
        <span class="nav-icon">ğŸ’°</span>
        <span class="nav-text">Ø§Ù„Ø³Ù„Ù</span>
    </div>
    <div class="nav-item" onclick="switchTab('workers', this)">
        <span class="nav-icon">ğŸ‘·</span>
        <span class="nav-text">Ø§Ù„Ø¹Ù…Ø§Ù„</span>
    </div>
    <div class="nav-item" onclick="switchTab('add', this)">
        <span class="nav-icon">â•</span>
        <span class="nav-text">Ø¥Ø¶Ø§ÙØ©</span>
    </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // === Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
    let workers = JSON.parse(localStorage.getItem('workersApp_Glass_v4')) || [];
    const attendanceModal = new bootstrap.Modal(document.getElementById('attendanceModal'));

    window.onload = function() {
        renderMainTable();
        updateSelectMenu();
        renderWorkersManagement();
    };

    function formatMoney(amount) {
        return parseFloat(amount).toLocaleString('en-US') + ' Ø¯.Ø¹';
    }

    // === Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ===
    function switchTab(tabName, navElement) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navElement.classList.add('active');
        
        if(tabName === 'home') renderMainTable();
        if(tabName === 'loans') updateSelectMenu();
        if(tabName === 'workers') renderWorkersManagement();
    }

    // === 1. Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ ===
    function addNewWorker() {
        const nameInp = document.getElementById('newWorkerName');
        const name = nameInp.value.trim();
        if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…!");

        workers.push({ name: name, history: [] });
        saveData();
        nameInp.value = '';
        
        document.querySelector('.nav-item:first-child').click(); 
    }

    // === 2. Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø­Ø¶ÙˆØ±) ===
    function renderMainTable() {
        const tbody = document.getElementById('mainTableBody');
        tbody.innerHTML = '';
        if(workers.length > 0) document.getElementById('emptyMsg').style.display = 'none';

        const today = new Date().toISOString().split('T')[0];
        let grandTotal = 0; // Ù…ØªØºÙŠØ± Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ

        workers.forEach((worker, index) => {
            const todayRecord = worker.history.find(h => h.date === today && (h.type === 'wage' || h.type === 'absent'));
            const isPresent = todayRecord && todayRecord.type === 'wage';
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯
            let balance = calculateBalance(worker);
            grandTotal += balance; // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ

            // Ø§Ù„Ù…Ù†Ø·Ù‚: Ø¥Ø°Ø§ Ø§Ù„Ø±ØµÙŠØ¯ Ù…ÙˆØ¬Ø¨ (Ø¹Ù„ÙŠÙ‡ Ø¯ÙŠÙ†) ÙŠÙƒÙˆÙ† Ø£Ø­Ù…Ø±ØŒ Ø¥Ø°Ø§ Ø³Ø§Ù„Ø¨ (ÙŠØ·Ù„Ø¨Ù†Ø§) ÙŠÙƒÙˆÙ† Ø£Ø®Ø¶Ø±
            let colorClass = balance > 0 ? 'balance-neg' : 'balance-pos';
            
            let checkIcon = isPresent ? 'âœ…' : 'â¬œ';
            let checkClass = isPresent ? 'btn-check-custom checked' : 'btn-check-custom';

            tbody.innerHTML += `
                <tr>
                    <td>${index + 1}</td>
                    <td class="fw-bold">${worker.name}</td>
                    <td><div class="${checkClass}" onclick="toggleAttendance(${index})">${checkIcon}</div></td>
                    <td class="${colorClass}" style="direction:ltr">${formatMoney(balance)}</td>
                </tr>
            `;
        });

        // Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
        const grandTotalEl = document.getElementById('grandTotalDisplay');
        grandTotalEl.innerText = formatMoney(grandTotal);
        // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ
        if(grandTotal > 0) { grandTotalEl.className = "fw-bold m-0 balance-neg"; }
        else { grandTotalEl.className = "fw-bold m-0 balance-pos"; }
    }

    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
    function toggleAttendance(index) {
        const today = new Date().toISOString().split('T')[0];
        const worker = workers[index];
        
        const existingRecordIndex = worker.history.findIndex(h => h.date === today && (h.type === 'wage' || h.type === 'absent'));
        const wasPresent = existingRecordIndex !== -1 && worker.history[existingRecordIndex].type === 'wage';

        if (existingRecordIndex !== -1) {
            worker.history.splice(existingRecordIndex, 1);
        }

        if (wasPresent) {
            if(confirm("ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ ØºÙŠØ§Ø¨ØŸ")) {
                worker.history.push({ date: today, type: 'absent', amount: 0 });
            } else {
                worker.history.push({ date: today, type: 'wage', amount: 25000 });
            }
        } else {
            let wage = prompt("Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ø¹Ø§Ù…Ù„ " + worker.name + ":", "25000");
            if (wage && !isNaN(wage)) {
                worker.history.push({ date: today, type: 'wage', amount: parseFloat(wage) });
            }
        }
        
        saveData();
        renderMainTable();
    }

    // === 3. Ø§Ù„Ø³Ù„Ù ===
    function updateSelectMenu() {
        const select = document.getElementById('workerSelect');
        const oldVal = select.value;
        select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>';
        workers.forEach((w, i) => { select.innerHTML += `<option value="${i}">${w.name}</option>`; });
        select.value = oldVal;
    }

    function loadWorkerHistory() {
        const index = document.getElementById('workerSelect').value;
        const tbody = document.getElementById('historyTableBody');
        const dispBal = document.getElementById('dispBalance');

        tbody.innerHTML = '';
        if(index === "") { dispBal.innerText = "0 Ø¯.Ø¹"; return; }

        const worker = workers[index];
        let totalWithdraw = 0;
        let totalRepayAndWage = 0;

        [...worker.history].reverse().forEach(h => {
            if(h.type === 'absent') return;

            if(h.type === 'withdraw') totalWithdraw += h.amount;
            else totalRepayAndWage += h.amount;

            let typeText = h.type === 'withdraw' ? 'Ø³Ù„ÙØ©' : (h.type === 'repay' ? 'ØªØ³Ø¯ÙŠØ¯' : 'ÙŠÙˆÙ…ÙŠØ©');
            let color = h.type === 'withdraw' ? 'text-danger' : 'text-success';

            tbody.innerHTML += `
                <tr><td>${h.date}</td><td class="${color} fw-bold">${typeText}</td><td>${formatMoney(h.amount)}</td></tr>
            `;
        });

        // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© (Ø§Ù„Ø³Ù„Ù - Ø§Ù„Ø¹Ù…Ù„)
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ø§ØªØ¬ Ù…ÙˆØ¬Ø¨ = Ø¹Ù„ÙŠÙ‡ Ø¯ÙŠÙ†
        let finalBal = totalWithdraw - totalRepayAndWage;
        
        dispBal.innerText = formatMoney(finalBal);
        if(finalBal > 0) dispBal.className = "fw-bold mt-2 balance-neg"; // Ø£Ø­Ù…Ø±
        else dispBal.className = "fw-bold mt-2 balance-pos"; // Ø£Ø®Ø¶Ø±
    }

    function addTransaction(type) {
        const index = document.getElementById('workerSelect').value;
        const amount = parseFloat(document.getElementById('transAmount').value);
        if(index === "") return alert("Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹");
        if(!amount) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº");

        workers[index].history.push({
            date: new Date().toISOString().split('T')[0],
            type: type, amount: amount
        });
        saveData();
        document.getElementById('transAmount').value = '';
        loadWorkerHistory(); 
    }

    // === 4. ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„ (Ø¥Ø¯Ø§Ø±Ø©) ===
    function renderWorkersManagement() {
        const container = document.getElementById('manageWorkersList');
        container.innerHTML = '';

        if(workers.length === 0) {
            container.innerHTML = '<div class="text-center p-3">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ø§Ù„.</div>';
            return;
        }

        workers.forEach((worker, index) => {
            container.innerHTML += `
                <div class="worker-list-item">
                    <span class="worker-name-click" onclick="showWorkerDetails(${index})">
                       <span class="text-warning ms-2">#${index + 1}</span> ğŸ‘¤ ${worker.name}
                    </span>
                    <button class="btn btn-sm btn-danger" onclick="deleteWorker(${index})">
                        Ø­Ø°Ù ğŸ—‘ï¸
                    </button>
                </div>
            `;
        });
    }

    function deleteWorker(index) {
        if(confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØ³Ø¬Ù„Ø§ØªÙ‡ØŸ")) {
            workers.splice(index, 1);
            saveData();
            renderWorkersManagement();
            renderMainTable();
        }
    }

    function showWorkerDetails(index) {
        const worker = workers[index];
        const listContainer = document.getElementById('attPresentList');
        document.getElementById('attModalTitle').innerText = "Ø³Ø¬Ù„: " + worker.name;
        
        listContainer.innerHTML = '';
        
        const days = worker.history.filter(h => h.type === 'wage' || h.type === 'absent');
        
        if(days.length === 0) {
            listContainer.innerHTML = '<li class="list-group-item bg-transparent text-white border-0 text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</li>';
        } else {
            [...days].reverse().forEach(day => {
                let badge = '';
                if(day.type === 'wage') badge = '<span class="badge bg-success">âœ… Ø­Ø§Ø¶Ø±</span>';
                else badge = '<span class="badge bg-danger">âŒ ØºØ§Ø¦Ø¨</span>';

                listContainer.innerHTML += `
                    <li class="list-group-item bg-transparent text-white border-light d-flex justify-content-between">
                        <span>ğŸ“… ${day.date}</span>
                        ${badge}
                    </li>
                `;
            });
        }
        
        attendanceModal.show();
    }

    // === Ø£Ø¯ÙˆØ§Øª ===
    // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©): Ø§Ù„Ø±ØµÙŠØ¯ = Ø§Ù„Ø³Ù„Ù - Ø§Ù„Ø¹Ù…Ù„
    function calculateBalance(worker) {
        let credit = 0, debit = 0;
        worker.history.forEach(h => {
            if(h.type === 'wage' || h.type === 'repay') credit += h.amount;
            if(h.type === 'withdraw') debit += h.amount;
        });
        return debit - credit; // Ø§Ù„Ø³Ø­Ø¨ (Ø¹Ù„ÙŠÙ‡) - Ø§Ù„Ø¹Ù…Ù„ (Ù„Ù‡)
    }

    function saveData() {
        localStorage.setItem('workersApp_Glass_v4', JSON.stringify(workers));
    }
</script>

</body>
</html>
