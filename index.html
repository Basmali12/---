<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณุฌู ุงูุนูุงู ูุงูููุงููุงุช</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
        .card-custom { box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 10px; border: none; margin-bottom: 20px; }
        .balance-positive { color: green; font-weight: bold; }
        .balance-negative { color: red; font-weight: bold; }
        .worker-row { cursor: pointer; transition: background 0.2s; }
        .worker-row:hover { background-color: #e9ecef; }
    </style>
</head>
<body>

<div class="container py-4">
    <h2 class="text-center mb-4">๐ทโโ๏ธ ุณุฌู ุงูุนูุงู ูุงูููุงููุงุช</h2>

    <div class="card card-custom p-3">
        <h5>ุฅุถุงูุฉ ุนุงูู ุฌุฏูุฏ</h5>
        <div class="input-group mb-3">
            <input type="text" id="newWorkerName" class="form-control" placeholder="ุงูุชุจ ุงุณู ุงูุนุงูู ููุง...">
            <button class="btn btn-primary" onclick="addWorker()">ุฅุถุงูุฉ</button>
        </div>
    </div>

    <div class="card card-custom p-3">
        <h5>ูุงุฆูุฉ ุงูุนูุงู ูุงูููููุงุช</h5>
        <div class="table-responsive">
            <table class="table table-bordered text-center">
                <thead class="table-dark">
                    <tr>
                        <th>ุงูุงุณู</th>
                        <th>ูุฌููุน ุงูุนูู (ูู)</th>
                        <th>ูุฌููุน ุงูุณูู (ุนููู)</th>
                        <th>ุงูุตุงูู (ุงูุจุงูู)</th>
                        <th>ุฅุฌุฑุงุกุงุช</th>
                    </tr>
                </thead>
                <tbody id="workersTableBody">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="transactionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ุชุณุฌูู ููููุฉ / ุณููุฉ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6 id="modalWorkerName" class="text-primary mb-3"></h6>
                <input type="hidden" id="selectedWorkerIndex">
                
                <div class="mb-3">
                    <label class="form-label">ุงูุชุงุฑูุฎ:</label>
                    <input type="date" id="transDate" class="form-control">
                </div>
                
                <div class="mb-3">
                    <label class="form-label">ูู ุญุถุฑ ููุนููุ (โ)</label>
                    <select class="form-select" id="transStatus" onchange="toggleWageInput()">
                        <option value="present">ูุนู (ุญุงุถุฑ)</option>
                        <option value="absent">ูุง (ุบุงุฆุจ)</option>
                    </select>
                </div>

                <div class="mb-3" id="wageDiv">
                    <label class="form-label">ูููุฉ ุงูููููุฉ (ุงููุจูุบ ุงููุณุชุญู ูู):</label>
                    <input type="number" id="transWage" class="form-control" placeholder="ูุซูุงู: 25000">
                </div>

                <div class="mb-3">
                    <label class="form-label">ุณุญุจ ุณููุฉ (ุงููุจูุบ ุงููุณุญูุจ):</label>
                    <input type="number" id="transWithdraw" class="form-control" placeholder="ูุซูุงู: 5000">
                    <small class="text-muted">ุงุชุฑูู ูุงุฑุบุงู ุฃู 0 ุฅุฐุง ูู ูุณุญุจ ุดูุฆุงู.</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
                <button type="button" class="btn btn-success" onclick="saveTransaction()">ุญูุธ ุงูุณุฌู</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // 1. ุชุนุฑูู ุงููุชุบูุฑุงุช ูุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช ุงููุญููุธุฉ
    let workers = JSON.parse(localStorage.getItem('workersData')) || [];
    const transactionModal = new bootstrap.Modal(document.getElementById('transactionModal'));

    // ุฏุงูุฉ ุชุนูู ุนูุฏ ูุชุญ ุงูุตูุญุฉ
    window.onload = function() {
        renderTable();
        document.getElementById('transDate').valueAsDate = new Date();
    };

    // 2. ุฅุถุงูุฉ ุนุงูู ุฌุฏูุฏ
    function addWorker() {
        const nameInput = document.getElementById('newWorkerName');
        const name = nameInput.value.trim();
        
        if (name) {
            workers.push({
                name: name,
                totalWage: 0,      // ูุฌููุน ูุง ุงุดุชุบูู
                totalWithdraw: 0,  // ูุฌููุน ูุง ุณุญุจู
                history: []        // ุณุฌู ุงูุฃูุงู
            });
            saveData();
            nameInput.value = '';
            renderTable();
        } else {
            alert('ูุฑุฌู ูุชุงุจุฉ ุงุณู ุงูุนุงูู');
        }
    }

    // 3. ุนุฑุถ ุงูุฌุฏูู
    function renderTable() {
        const tbody = document.getElementById('workersTableBody');
        tbody.innerHTML = '';

        workers.forEach((worker, index) => {
            const balance = worker.totalWage - worker.totalWithdraw;
            const balanceClass = balance >= 0 ? 'balance-positive' : 'balance-negative';

            tbody.innerHTML += `
                <tr class="worker-row">
                    <td class="fw-bold">${worker.name}</td>
                    <td>${worker.totalWage.toLocaleString()}</td>
                    <td>${worker.totalWithdraw.toLocaleString()}</td>
                    <td class="${balanceClass}">${balance.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="openModal(${index})">
                             ุชุณุฌูู ููููุฉ ๐
                        </button>
                        <button class="btn btn-sm btn-outline-info" onclick="showDetails(${index})">
                             ุงูุชูุงุตูู ๐๏ธ
                        </button>
                    </td>
                </tr>
            `;
        });
    }

    // 4. ูุชุญ ูุงูุฐุฉ ุงูุชุณุฌูู
    function openModal(index) {
        document.getElementById('selectedWorkerIndex').value = index;
        document.getElementById('modalWorkerName').innerText = "ุงูุนุงูู: " + workers[index].name;
        document.getElementById('transWage').value = '';
        document.getElementById('transWithdraw').value = '';
        document.getElementById('transStatus').value = 'present';
        toggleWageInput();
        transactionModal.show();
    }

    // ุงูุชุญูู ูู ุธููุฑ ุญูู ุงูุฃุฌุฑุฉ (ุฅุฐุง ูุงู ุบุงุฆุจุงู ูุง ุชูุฌุฏ ุฃุฌุฑุฉ)
    function toggleWageInput() {
        const status = document.getElementById('transStatus').value;
        const wageDiv = document.getElementById('wageDiv');
        if(status === 'absent') {
            wageDiv.style.display = 'none';
            document.getElementById('transWage').value = 0;
        } else {
            wageDiv.style.display = 'block';
        }
    }

    // 5. ุญูุธ ุงูุนูููุฉ (ุงูุญุถูุฑ ูุงูุณูู)
    function saveTransaction() {
        const index = document.getElementById('selectedWorkerIndex').value;
        const date = document.getElementById('transDate').value;
        const status = document.getElementById('transStatus').value; // present or absent
        const wage = parseFloat(document.getElementById('transWage').value) || 0;
        const withdraw = parseFloat(document.getElementById('transWithdraw').value) || 0;

        // ุชุญุฏูุซ ุจูุงูุงุช ุงูุนุงูู
        workers[index].totalWage += wage;
        workers[index].totalWithdraw += withdraw;
        
        // ุฅุถุงูุฉ ููุณุฌู
        workers[index].history.push({
            date: date,
            status: status,
            wage: wage,
            withdraw: withdraw
        });

        saveData();
        transactionModal.hide();
        renderTable();
    }

    // 6. ุนุฑุถ ุงูุชูุงุตูู (ุณุฌู ุงูุฃูุงู) - ุจุณูุท ููุนุฑุถ
    function showDetails(index) {
        let log = `ุณุฌู: ${workers[index].name}\n----------------\n`;
        workers[index].history.forEach(record => {
            const statusText = record.status === 'present' ? 'โ ุญุงุถุฑ' : 'โ ุบุงุฆุจ';
            log += `ุงูุชุงุฑูุฎ: ${record.date}\nุงูุญุงูุฉ: ${statusText}\nุงูุฃุฌุฑุฉ: ${record.wage}\nุงูุณููุฉ: ${record.withdraw}\n----------------\n`;
        });
        alert(log); // ูููู ุชุทููุฑ ูุฐุง ููููู ุตูุญุฉ ูููุตูุฉ ูุงุญูุงู
    }

    // 7. ุญูุธ ุงูุจูุงูุงุช ูู ุงููุชุตูุญ
    function saveData() {
        localStorage.setItem('workersData', JSON.stringify(workers));
    }
</script>

</body>
</html>
